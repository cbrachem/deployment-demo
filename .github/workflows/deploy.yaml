name: "Make some comments"

on:
  pull_request:
    types: [labeled, opened, synchronize]

jobs:
  deploy:
    if: |
      (github.event.action == 'labeled' && github.event.label.name == ':rocket: deploy') ||
      (github.event.action != 'labeled' && contains(github.event.pull_request.labels.*.name, ':rocket: deploy'))
    runs-on: ubuntu-latest
    permissions: write-all
    steps:
      - name: Write a comment
        id: comment
        uses: actions/github-script@v6
        with:
          script: |
            const c = await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'ðŸ‘‹ Hi! This is PR ##' + context.issue.number
            })
            console.log(c)
            core.setOutput('c', c)
            core.setOutput('id', c.id)
      
      - name: Wait a bit
        run: sleep 20
      
      - name: Update comment
        uses: actions/github-script@v6
        env:
          COMMENT_ID: steps.comment.id
        with:
          script: |
            github.rest.issues.updateComment({
              comment_id: process.env.COMMENT_ID,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'All done!'
            })
